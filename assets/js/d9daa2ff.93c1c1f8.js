"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9786],{9162:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>a});var r=s(4848),t=s(8453);const i={sidebar_position:12,id:"aztec-sequencer"},c="Running an Aztec Node with Sedge (Full Node or Sequencer)",o={id:"quickstart/aztec-sequencer",title:"Running an Aztec Node with Sedge (Full Node or Sequencer)",description:"What is Aztec?",source:"@site/docs/quickstart/aztec.mdx",sourceDirName:"quickstart",slug:"/quickstart/aztec-sequencer",permalink:"/docs/quickstart/aztec-sequencer",draft:!1,unlisted:!1,editUrl:"https://github.com/NethermindEth/sedge/tree/main/docs/docs/quickstart/aztec.mdx",tags:[],version:"current",sidebarPosition:12,frontMatter:{sidebar_position:12,id:"aztec-sequencer"},sidebar:"tutorialSidebar",previous:{title:"Running an Optimism Node with Sedge",permalink:"/docs/quickstart/running-optimism-node"},next:{title:"Commands",permalink:"/docs/commands"}},l={},a=[{value:"What is Aztec?",id:"what-is-aztec",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Workflow breakdown",id:"workflow-breakdown",level:2},{value:"1) Generate the Aztec sequencer keystore (sequencer only)",id:"1-generate-the-aztec-sequencer-keystore-sequencer-only",level:2},{value:"2) Generate the stack with Sedge",id:"2-generate-the-stack-with-sedge",level:2},{value:"Aztec full node (default)",id:"aztec-full-node-default",level:3},{value:"Aztec sequencer",id:"aztec-sequencer",level:3},{value:"Useful optional flags",id:"useful-optional-flags",level:3},{value:"3) Run the stack",id:"3-run-the-stack",level:2},{value:"4) Monitoring (Prometheus + Grafana)",id:"4-monitoring-prometheus--grafana",level:2},{value:"<strong>Monitoring through Grafana Dashboards</strong>",id:"monitoring-through-grafana-dashboards",level:3},{value:"How to Launch the Grafana Service",id:"how-to-launch-the-grafana-service",level:4},{value:"OTLP metrics port (must match)",id:"otlp-metrics-port-must-match",level:4},{value:"<strong>Alerting for Aztec Exporter and Sequencer</strong>",id:"alerting-for-aztec-exporter-and-sequencer",level:3},{value:"I. Initialize the monitoring stack with Aztec-specific configurations:",id:"i-initialize-the-monitoring-stack-with-aztec-specific-configurations",level:4},{value:"II. Verify Prometheus targets and rules",id:"ii-verify-prometheus-targets-and-rules",level:4},{value:"III. View alerts in Grafana OnCall",id:"iii-view-alerts-in-grafana-oncall",level:4},{value:"IV. Configure Contact Points in Grafana OnCall",id:"iv-configure-contact-points-in-grafana-oncall",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"running-an-aztec-node-with-sedge-full-node-or-sequencer",children:"Running an Aztec Node with Sedge (Full Node or Sequencer)"})}),"\n",(0,r.jsx)(n.h2,{id:"what-is-aztec",children:"What is Aztec?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://docs.aztec.network/",children:"Aztec"})," is a privacy-first L2 that uses a sequencer to order and publish L2 blocks to Ethereum (L1)."]}),"\n",(0,r.jsxs)(n.p,{children:["Sedge can generate a Docker Compose setup for an ",(0,r.jsx)(n.strong,{children:"Aztec node"}),", including:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["An ",(0,r.jsx)(n.strong,{children:"Ethereum execution client"})]}),"\n",(0,r.jsxs)(n.li,{children:["An ",(0,r.jsx)(n.strong,{children:"Ethereum consensus client"})]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.strong,{children:"Aztec node"})," client (full node or sequencer)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.admonition,{title:"Supported networks",type:"info",children:(0,r.jsxs)(n.p,{children:["Sedge currently provides Aztec sequencer templates for ",(0,r.jsx)(n.code,{children:"--network mainnet"})," and ",(0,r.jsx)(n.code,{children:"--network sepolia"}),"."]})}),"\n",(0,r.jsx)(n.p,{children:"Before you generate the stack, you will need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docker + Docker Compose plugin"})," (see ",(0,r.jsx)(n.a,{href:"./dependencies",children:"Dependencies"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.em,{children:"(Sequencer only)"})," An ",(0,r.jsx)(n.strong,{children:"Aztec sequencer keystore"})," (",(0,r.jsx)(n.code,{children:"keystore.json"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"P2P IP address"})," that other nodes can reach (typically your machine\u2019s public IP)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"workflow-breakdown",children:"Workflow breakdown"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Generate your Aztec sequencer keystore"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Generate the Sedge stack"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Run the stack"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.em,{children:"(Optional)"})," ",(0,r.jsx)(n.strong,{children:"Enable monitoring (Prometheus + Grafana)"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-generate-the-aztec-sequencer-keystore-sequencer-only",children:"1) Generate the Aztec sequencer keystore (sequencer only)"}),"\n",(0,r.jsx)(n.p,{children:"Aztec expects the keystore to be generated using the Aztec tooling:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aztec validator-keys new\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This will produce a ",(0,r.jsx)(n.code,{children:"keystore.json"})," file you will pass to Sedge."]}),"\n",(0,r.jsxs)(n.p,{children:["For the latest Aztec instructions, see the Aztec docs on sequencer management: ",(0,r.jsx)(n.code,{children:"https://docs.aztec.network/network/setup/sequencer_management"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"2-generate-the-stack-with-sedge",children:"2) Generate the stack with Sedge"}),"\n",(0,r.jsxs)(n.p,{children:["Sedge uses a single generator command for Aztec. Select the mode with ",(0,r.jsx)(n.code,{children:"--type"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--type node"}),": Aztec ",(0,r.jsx)(n.strong,{children:"full node"})," (default)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--type sequencer"}),": Aztec ",(0,r.jsx)(n.strong,{children:"sequencer"})," (requires keystore + P2P IP)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"aztec-full-node-default",children:"Aztec full node (default)"}),"\n",(0,r.jsx)(n.p,{children:"From your Sedge directory (or wherever you run Sedge), generate an Aztec full node stack:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge generate aztec \\\n  --network sepolia \\\n  --execution nethermind \\\n  --consensus lighthouse\n"})}),"\n",(0,r.jsx)(n.h3,{id:"aztec-sequencer",children:"Aztec sequencer"}),"\n",(0,r.jsx)(n.p,{children:"From your Sedge directory (or wherever you run Sedge), generate an Aztec sequencer stack:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge generate aztec \\\n  --type sequencer \\\n  --network sepolia \\\n  --execution nethermind \\\n  --consensus lighthouse \\\n  --aztec-keystore-path /path/to/keystore.json \\\n  --aztec-p2p-ip <YOUR_PUBLIC_IP>\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"--aztec-keystore-path"})," is ",(0,r.jsx)(n.strong,{children:"required"})," when running with ",(0,r.jsx)(n.code,{children:"--type sequencer"}),"."]})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["Setting ",(0,r.jsx)(n.code,{children:"--execution-api-url"})," and ",(0,r.jsx)(n.code,{children:"--consensus-url"})," will skip generating the execution and consensus clients, and configure the Aztec sequencer to use your existing endpoints instead."]}),(0,r.jsx)(n.p,{children:"This is useful if you already have synced execution/consensus nodes. It will save synchronization time."}),(0,r.jsxs)(n.p,{children:["For example you can set: ",(0,r.jsx)(n.code,{children:"sedge generate aztec --type sequencer --execution-api-url http://execution:port --consensus-url http://consensus:port -n sepolia --aztec-keystore-path /path/to/keystore.json --aztec-p2p-ip <YOUR_PUBLIC_IP>"})]})]}),"\n",(0,r.jsx)(n.h3,{id:"useful-optional-flags",children:"Useful optional flags"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use a custom Aztec image"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge generate aztec --aztec-image <IMAGE>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pass extra Aztec flags"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sedge generate aztec --aztec-extra-flag "p2p.maxPeers=200"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"3-run-the-stack",children:"3) Run the stack"}),"\n",(0,r.jsx)(n.p,{children:"Start the generated Docker Compose stack:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge run\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If you generated into a custom directory, pass the same path to ",(0,r.jsx)(n.code,{children:"sedge run"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge run --path /path/to/sedge-data\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4-monitoring-prometheus--grafana",children:"4) Monitoring (Prometheus + Grafana)"}),"\n",(0,r.jsx)(n.h3,{id:"monitoring-through-grafana-dashboards",children:(0,r.jsx)(n.strong,{children:"Monitoring through Grafana Dashboards"})}),"\n",(0,r.jsx)(n.p,{children:"Sedge provides an integrated monitoring stack with pre-configured Grafana dashboards. These dashboards display detailed insights about your Aztec node/sequencer performance, including key metrics such as L1/L2 block height progress, peer count, and sequencer health state."}),"\n",(0,r.jsx)(n.h4,{id:"how-to-launch-the-grafana-service",children:"How to Launch the Grafana Service"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"To initialize and start the monitoring stack, run the following command:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge monitoring init aztec\n"})}),"\n",(0,r.jsx)(n.p,{children:"The following flags can also be included:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--metrics-port"}),": Port where Prometheus will scrape the Aztec metrics from the collector (default: ",(0,r.jsx)(n.code,{children:"9464"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--otlp-grpc-port"}),": OTLP gRPC receiver port for Aztec nodes to send metrics to (default: ",(0,r.jsx)(n.code,{children:"4317"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--otlp-http-port"}),": OTLP HTTP receiver port for Aztec nodes to send metrics to (default: ",(0,r.jsx)(n.code,{children:"4318"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--log-level"}),": Collector log level (default: ",(0,r.jsx)(n.code,{children:"info"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--metric-expiry"}),": How long to keep stale metric series before expiring them (default: ",(0,r.jsx)(n.code,{children:"5m"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"This will install and configure the monitoring services for your Aztec node, including Grafana and Prometheus, as well as the Grafana OnCall and Prometheus alertmanager modules."}),"\n",(0,r.jsxs)(n.li,{children:["Once the monitoring stack is running, you can access the Grafana dashboards by navigating to ",(0,r.jsx)(n.code,{children:"http://localhost:3000"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"otlp-metrics-port-must-match",children:"OTLP metrics port (must match)"}),"\n",(0,r.jsx)(n.p,{children:"The generated Aztec sequencer config sends OTLP HTTP metrics to:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"http://sedge_aztec_exporter:<PORT>/v1/metrics"})}),"\n",(0,r.jsxs)(n.p,{children:["By default, ",(0,r.jsx)(n.code,{children:"<PORT>"})," is ",(0,r.jsx)(n.code,{children:"4318"}),". If you change the port, update it in both places:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Aztec generation"}),": ",(0,r.jsx)(n.code,{children:"sedge generate aztec --otel-metrics-port <PORT>"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring collector"}),": ",(0,r.jsx)(n.code,{children:"sedge monitoring init aztec --otlp-http-port <PORT>"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Example (port ",(0,r.jsx)(n.code,{children:"14318"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge generate aztec --otel-metrics-port 14318 \\\n  --type sequencer \\\n  --aztec-keystore-path /path/to/keystore.json \\\n  --aztec-p2p-ip <YOUR_PUBLIC_IP>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge monitoring init aztec --otlp-http-port 14318\n"})}),"\n",(0,r.jsx)(n.h3,{id:"alerting-for-aztec-exporter-and-sequencer",children:(0,r.jsx)(n.strong,{children:"Alerting for Aztec Exporter and Sequencer"})}),"\n",(0,r.jsxs)(n.p,{children:["To monitor critical events from your Aztec node operations (exporter down, sequencer unhealthy, etc.), ",(0,r.jsx)(n.strong,{children:"Grafana OnCall"})," is connected to ",(0,r.jsx)(n.strong,{children:"Prometheus Alertmanager"}),". Sedge's monitoring stack provides pre-configured alerts for common Aztec failure scenarios."]}),"\n",(0,r.jsx)(n.h4,{id:"i-initialize-the-monitoring-stack-with-aztec-specific-configurations",children:"I. Initialize the monitoring stack with Aztec-specific configurations:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sedge monitoring init aztec\n"})}),"\n",(0,r.jsx)(n.h4,{id:"ii-verify-prometheus-targets-and-rules",children:"II. Verify Prometheus targets and rules"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Open Prometheus at ",(0,r.jsx)(n.code,{children:"http://localhost:9090"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.code,{children:"/targets"})," to confirm the Aztec exporter is up."]}),"\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.code,{children:"/rules"})," to confirm the Aztec alert group is loaded."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"iii-view-alerts-in-grafana-oncall",children:"III. View alerts in Grafana OnCall"}),"\n",(0,r.jsxs)(n.p,{children:["In your Grafana instance (",(0,r.jsx)(n.code,{children:"http://localhost:3000"}),"):"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.strong,{children:"Alerts & IRM"})," and select ",(0,r.jsx)(n.strong,{children:"OnCall"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["You should see Aztec alerts such as:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Aztec exporter down"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Node not processing L2 blocks"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Low peer count"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Node not seeing new L1 blocks"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Sequencer not healthy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"High block proposal failure rate"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Blob publishing failures"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"iv-configure-contact-points-in-grafana-oncall",children:"IV. Configure Contact Points in Grafana OnCall"}),"\n",(0,r.jsx)(n.p,{children:"To start receiving alerts:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Navigate to ",(0,r.jsx)(n.strong,{children:"OnCall"})," settings in Grafana."]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure that your ",(0,r.jsx)(n.strong,{children:"contact points"})," (email, Slack, Telegram, etc.) are configured for notifications."]}),"\n",(0,r.jsx)(n.li,{children:"Grafana will send notifications based on the pre-configured alert rules whenever critical events occur."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"No Aztec metrics in Grafana"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Confirm the monitoring stack is running (",(0,r.jsx)(n.code,{children:"sedge monitoring init aztec"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Confirm the ports match (see ",(0,r.jsx)(n.a,{href:"#otlp-metrics-port-must-match",children:"OTLP metrics port (must match)"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Check Prometheus targets at ",(0,r.jsx)(n.code,{children:"http://localhost:9090/targets"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Sequencer not reachable by peers"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"--aztec-p2p-ip"})," is a reachable IP (not ",(0,r.jsx)(n.code,{children:"127.0.0.1"}),")"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var r=s(6540);const t={},i=r.createContext(t);function c(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);